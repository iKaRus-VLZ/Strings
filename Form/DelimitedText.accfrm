Version =20
VersionRequired =20
Checksum =1593017019
Begin Form
    RecordSelectors = NotDefault
    NavigationButtons = NotDefault
    DividingLines = NotDefault
    AllowDesignChanges = NotDefault
    DefaultView =0
    ScrollBars =0
    RecordLocks =2
    TabularCharSet =204
    TabularFamily =0
    PictureAlignment =2
    DatasheetGridlinesBehavior =3
    GridY =10
    Width =7037
    DatasheetFontHeight =10
    ItemSuffix =57
    Left =9015
    Top =1185
    Right =16050
    Bottom =5910
    DatasheetGridlinesColor =12632256
    Tag ="BackColor=Light"
    RecSrcDt = Begin
        0x0c1477270c51e540
    End
    GUID = Begin
        0x2353690662e0e54a897bab74cd97ccee
    End
    NameMap = Begin
        0x0acc0e5500000000000000000000000000000000000000000c00000005000000 ,
        0x0000000000000000000000000000
    End
    OnOpen ="[Event Procedure]"
    DatasheetFontName ="Arial"
    PrtMip = Begin
        0x6801000068010000680100006801000000000000201c0000e010000001000000 ,
        0x010000006801000000000000a10700000100000001000000
    End
    PrtDevMode = Begin
        0x00000000000000009061040800000000205662baf77f0000335c03baf77f0000 ,
        0x0104220b9c006c01032f00000100090000000000640001000f002c0102000100 ,
        0x2c010200000041340061870500000000feffffffffffffff25ddf8adff7f0000 ,
        0xc0c0c00000005802180000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000046500800 ,
        0x4d53414343455353000000000000000000000000000000000000000000000000 ,
        0xff3e03005802aa00ac00aa00ac00010000003100436f7572696572204e657700 ,
        0x0000000000000000000000000000000000000000010001000200000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000009600 ,
        0x4b002c0100800000
    End
    PrtDevNames = Begin
        0x080015001f000100000000000000000000000000000000000000000000000046 ,
        0x505231313a00
    End
    OnResize ="[Event Procedure]"
    FilterOnLoad =0
    DatasheetGridlinesColor12 =12632256
    PrtDevModeW = Begin
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0104220bdc006c01032f00000100090000000000640001000f002c0102000100 ,
        0x2c01020000004100340000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000005802180000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000046500800 ,
        0x4d53414343455353000000000000000000000000000000000000000000000000 ,
        0xff3e03005802aa00ac00aa00ac00010000003100436f7572696572204e657700 ,
        0x0000000000000000000000000000000000000000010001000200000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000000000000000000009600 ,
        0x4b002c0100800000
    End
    PrtDevNamesW = Begin
        0x040011001b000100000000000000000000000000000000000000000000000000 ,
        0x0000000000000000000000000000000000000000000046005000520031003100 ,
        0x3a000000
    End
    NoSaveCTIWhenDisabled =1
    Begin
        Begin Label
            BackStyle =0
            TextFontCharSet =204
            FontName ="Tahoma"
        End
        Begin Line
            BorderLineStyle =0
            Width =1701
        End
        Begin CommandButton
            TextFontCharSet =204
            Width =1701
            Height =283
            FontSize =8
            FontWeight =400
            ForeColor =-2147483630
            FontName ="Tahoma"
            BorderLineStyle =0
        End
        Begin CheckBox
            SpecialEffect =2
            BorderLineStyle =0
            LabelX =230
            LabelY =-30
        End
        Begin TextBox
            FELineBreak = NotDefault
            SpecialEffect =2
            OldBorderStyle =0
            TextFontCharSet =204
            BorderLineStyle =0
            Width =1701
            LabelX =-1701
            FontName ="Tahoma"
            AsianLineBreak =255
        End
        Begin ComboBox
            SpecialEffect =2
            TextFontCharSet =204
            BorderLineStyle =0
            Width =1701
            LabelX =-1701
            FontName ="Tahoma"
        End
        Begin Subform
            SpecialEffect =2
            BorderLineStyle =0
            Width =1701
            Height =1701
        End
        Begin FormHeader
            Height =557
            BackColor =-2147483633
            Name ="ЗаголовокФормы"
            Tag ="BackColor=Dark"
            GUID = Begin
                0x348048e0b4c55c479d0a7da5523cbe97
            End
            Begin
                Begin Label
                    OverlapFlags =93
                    Left =103
                    Top =103
                    Width =6695
                    Height =454
                    FontSize =14
                    FontWeight =700
                    ForeColor =9605778
                    Name ="lblTitle2"
                    Caption ="Заголовок"
                    Tag ="FontColor=Grey"
                    GUID = Begin
                        0x1e329f07c4c6e545b11970f0fe559ea0
                    End
                    LayoutCachedLeft =103
                    LayoutCachedTop =103
                    LayoutCachedWidth =6798
                    LayoutCachedHeight =557
                End
                Begin Label
                    OverlapFlags =223
                    Left =60
                    Top =60
                    Width =6695
                    Height =454
                    FontSize =14
                    FontWeight =700
                    Name ="lblTitle"
                    Caption ="Заголовок"
                    Tag ="FontColor=White"
                    GUID = Begin
                        0x8dad2fa00bf041449a3a7a4ed142aa63
                    End
                    LayoutCachedLeft =60
                    LayoutCachedTop =60
                    LayoutCachedWidth =6755
                    LayoutCachedHeight =514
                    ForeThemeColorIndex =0
                End
                Begin Line
                    OverlapFlags =87
                    SpecialEffect =5
                    Left =70
                    Top =510
                    Width =6835
                    Name ="Line01"
                    GUID = Begin
                        0x726684040683c74f9f64e6af1c2da81e
                    End
                    LayoutCachedLeft =70
                    LayoutCachedTop =510
                    LayoutCachedWidth =6905
                    LayoutCachedHeight =510
                End
            End
        End
        Begin Section
            CanGrow = NotDefault
            Height =2835
            BackColor =-2147483633
            Name ="ОбластьДанных"
            GUID = Begin
                0xb69a7a2fedba7a48994e9ceccc4baffe
            End
            Begin
                Begin Subform
                    OverlapFlags =85
                    Left =90
                    Top =1511
                    Width =6865
                    Height =1319
                    Name ="ctlData"
                    GUID = Begin
                        0xd6f825f15b31954a878e0b1623c7060c
                    End

                    LayoutCachedLeft =90
                    LayoutCachedTop =1511
                    LayoutCachedWidth =6955
                    LayoutCachedHeight =2830
                End
                Begin ComboBox
                    RowSourceTypeInt =1
                    OldBorderStyle =0
                    OverlapFlags =95
                    IMESentenceMode =3
                    Left =385
                    Top =1229
                    TabIndex =1
                    GUID = Begin
                        0xd646bd29eb86994b9311bbd14feedb2a
                    End
                    Name ="txtIdx"
                    RowSourceType ="Value List"
                    RowSource ="1;2;3"
                    AfterUpdate ="[Event Procedure]"

                    LayoutCachedLeft =385
                    LayoutCachedTop =1229
                    LayoutCachedWidth =2086
                    LayoutCachedHeight =1469
                    Begin
                        Begin Label
                            OverlapFlags =93
                            Left =385
                            Top =975
                            Width =1701
                            Height =240
                            Name ="Надпись54"
                            Caption ="Индекс параметра"
                            GUID = Begin
                                0xd4e2b7bd9292e14780d23a05d8efeb2a
                            End
                            LayoutCachedLeft =385
                            LayoutCachedTop =975
                            LayoutCachedWidth =2086
                            LayoutCachedHeight =1215
                        End
                    End
                End
                Begin TextBox
                    OverlapFlags =87
                    IMESentenceMode =3
                    Left =2086
                    Top =1229
                    Width =4869
                    TabIndex =2
                    Name ="txtVal"
                    AfterUpdate ="[Event Procedure]"
                    GUID = Begin
                        0x46b2b8a46478224bbac8eeca2ef84e3e
                    End

                    LayoutCachedLeft =2086
                    LayoutCachedTop =1229
                    LayoutCachedWidth =6955
                    LayoutCachedHeight =1469
                    Begin
                        Begin Label
                            OverlapFlags =95
                            Left =2086
                            Top =975
                            Width =4869
                            Height =240
                            Name ="Надпись55"
                            Caption ="Значение параметра"
                            GUID = Begin
                                0xc04914c3bf835249a7d9f7771bb767fa
                            End
                            LayoutCachedLeft =2086
                            LayoutCachedTop =975
                            LayoutCachedWidth =6955
                            LayoutCachedHeight =1215
                        End
                    End
                End
                Begin TextBox
                    OverlapFlags =87
                    TextAlign =1
                    IMESentenceMode =3
                    Left =1143
                    Top =60
                    Width =5387
                    Height =450
                    ColumnOrder =0
                    TabIndex =4
                    Name ="txtInput"
                    AfterUpdate ="[Event Procedure]"
                    GUID = Begin
                        0x69bcd966562ec346bf12bc4741f895e4
                    End

                    LayoutCachedLeft =1143
                    LayoutCachedTop =60
                    LayoutCachedWidth =6530
                    LayoutCachedHeight =510
                    Begin
                        Begin Label
                            OverlapFlags =93
                            Left =110
                            Top =60
                            Width =1035
                            Height =240
                            FontWeight =700
                            Name ="Надпись18"
                            Caption ="Строка:"
                            GUID = Begin
                                0xbd71e8313287ce41b0ddd855cce0f8ff
                            End
                            LayoutCachedLeft =110
                            LayoutCachedTop =60
                            LayoutCachedWidth =1145
                            LayoutCachedHeight =300
                        End
                    End
                End
                Begin CommandButton
                    OverlapFlags =85
                    Left =6615
                    Top =85
                    Width =340
                    Height =340
                    TabIndex =3
                    Name ="cmdNew"
                    Caption ="..."
                    OnClick ="[Event Procedure]"
                    PictureData = Begin
                        0x2800000010000000100000000100040000000000800000000000000000000000 ,
                        0x0000000000000000000000000000800000800000008080008000000080008000 ,
                        0x8080000080808000c0c0c0000000ff00c0c0c00000ffff00ff000000c0c0c000 ,
                        0xffff0000ffffff00dadadadadadadada00a00d00adadadad00d00a00dadadada ,
                        0xadadadadadadadaddadadadadadadadaadadadadadadad00dadad7dadadad000 ,
                        0xa7ad7c7dadad000d7c7ad7dadad000daa7adadadad000daddadadadad000dada ,
                        0xada7adad000dadadda7c7ad000dadadaada7ad0b0dadadaddadad0b0dadadada ,
                        0xadada70dadadadad
                    End
                    ObjectPalette = Begin
                        0x000301000000000000000000
                    End
                    ControlTipText ="Нажми меня!"
                    GUID = Begin
                        0x764a09bd110e144699a8258575ce4560
                    End

                    LayoutCachedLeft =6615
                    LayoutCachedTop =85
                    LayoutCachedWidth =6955
                    LayoutCachedHeight =425
                    WebImagePaddingLeft =2
                    WebImagePaddingTop =2
                    WebImagePaddingRight =1
                    WebImagePaddingBottom =1
                End
                Begin Line
                    OverlapFlags =85
                    SpecialEffect =5
                    Left =90
                    Top =900
                    Width =6865
                    Name ="Line02"
                    GUID = Begin
                        0xe76b5d223440f4488f6d7fc76e550aae
                    End
                    LayoutCachedLeft =90
                    LayoutCachedTop =900
                    LayoutCachedWidth =6955
                    LayoutCachedHeight =900
                End
                Begin TextBox
                    OverlapFlags =87
                    IMESentenceMode =3
                    Left =3868
                    Top =570
                    Width =2662
                    TabIndex =5
                    Name ="txtDelim"
                    AfterUpdate ="[Event Procedure]"
                    GUID = Begin
                        0xae0d9350e2e1b7408c2aef370dc473e5
                    End

                    LayoutCachedLeft =3868
                    LayoutCachedTop =570
                    LayoutCachedWidth =6530
                    LayoutCachedHeight =810
                    Begin
                        Begin Label
                            OverlapFlags =93
                            Left =2840
                            Top =570
                            Width =1035
                            Height =240
                            Name ="Надпись39"
                            Caption ="Разделители:"
                            GUID = Begin
                                0xb45e70be4427a94f929e37488535e6ae
                            End
                            LayoutCachedLeft =2840
                            LayoutCachedTop =570
                            LayoutCachedWidth =3875
                            LayoutCachedHeight =810
                        End
                    End
                End
                Begin ComboBox
                    LimitToList = NotDefault
                    RowSourceTypeInt =1
                    OldBorderStyle =0
                    OverlapFlags =87
                    IMESentenceMode =3
                    ColumnCount =2
                    Left =1138
                    Top =570
                    Width =1644
                    TabIndex =6
                    GUID = Begin
                        0x905c7024c23b384082e8f2056e7640c3
                    End
                    Name ="txtType"
                    RowSourceType ="Value List"
                    RowSource ="0;\"DelimString\";1;\"TaggedString\";2;\"TokenString\""
                    ColumnWidths ="0"
                    AfterUpdate ="[Event Procedure]"
                    DefaultValue ="0"

                    LayoutCachedLeft =1138
                    LayoutCachedTop =570
                    LayoutCachedWidth =2782
                    LayoutCachedHeight =810
                    Begin
                        Begin Label
                            OverlapFlags =93
                            Left =110
                            Top =570
                            Width =1035
                            Height =240
                            Name ="Надпись41"
                            Caption ="Тип:"
                            GUID = Begin
                                0x2f1bfff4414d1643aa1a755c490956de
                            End
                            LayoutCachedLeft =110
                            LayoutCachedTop =570
                            LayoutCachedWidth =1145
                            LayoutCachedHeight =810
                        End
                    End
                End
                Begin TextBox
                    Visible = NotDefault
                    OverlapFlags =85
                    IMESentenceMode =3
                    Left =6615
                    Top =566
                    Width =0
                    TabIndex =7
                    Name ="txtTagDelim"
                    AfterUpdate ="[Event Procedure]"
                    GUID = Begin
                        0xf54e76824c80cf429743adaf8149cbf7
                    End

                    LayoutCachedLeft =6615
                    LayoutCachedTop =566
                    LayoutCachedWidth =6615
                    LayoutCachedHeight =806
                End
            End
        End
        Begin FormFooter
            Height =1700
            BackColor =-2147483633
            Name ="ПримечаниеФормы"
            GUID = Begin
                0x2c3ddbc0df03ce48a6cb6bfa83e45501
            End
            Begin
                Begin Line
                    OverlapFlags =85
                    SpecialEffect =5
                    Left =85
                    Top =29
                    Width =6865
                    Name ="Line03"
                    GUID = Begin
                        0x2be8dfeb2a37ef4890a6eeb1b74534b0
                    End
                End
                Begin Label
                    OverlapFlags =93
                    Left =60
                    Top =60
                    Width =6645
                    Height =1380
                    Name ="lblComment"
                    Caption ="Комментарий"
                    GUID = Begin
                        0x0d0dfffaa8c8534ba707713278d54756
                    End
                    LayoutCachedLeft =60
                    LayoutCachedTop =60
                    LayoutCachedWidth =6705
                    LayoutCachedHeight =1440
                End
                Begin Label
                    FontUnderline = NotDefault
                    OverlapFlags =87
                    Left =60
                    Top =1440
                    Width =6645
                    Height =240
                    ForeColor =16711680
                    Name ="lblLink"
                    Caption ="Link:"
                    GUID = Begin
                        0xefc63edbe15f2b46b12bd7f9b84a2ccf
                    End
                    LayoutCachedLeft =60
                    LayoutCachedTop =1440
                    LayoutCachedWidth =6705
                    LayoutCachedHeight =1680
                End
            End
        End
    End
End
CodeBehindForm
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = True
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Compare Database
Option Explicit
Private Const c_strTitle = "Работа со строками с разделителями"
Private Const c_strComment = "Демонстрирует работу со строками с разделителями (в т.ч. со множественными разделителями) " & _
                             "и со строками именных параметров." & _
                             "В примере для этого используются функции DelimString[Get|Set|Del], TaggedString[Get|Set|Del], " & _
                             "TokenString[Get|Set|Del] и, для генерации случайного текста, - GenPassword." & vbCrLf & _
                             "В VBA есть замечательные функции Split/Join, но иногда их немножко не хватает." & vbCrLf & _
                             "Для работы со строками именных параметров (строки типа ""Параметр1=Значение1;..ПараметрN=ЗначениеN"") " & _
                             "лучше использовать класс вроде TaggedValues от Гетца."
Private Const c_strLink = "https://www.sql.ru/forum/661816/vdrug-u-kogo-est-dlya-obrabotki-v-vba-strok-svoystv"
Private Const Indent = 70 '0.125 * cm   ' отступ от края формы и расстояние между контроламиPrivate Const Indent = 0.15 * cm

Private Const c_lngScroll = 13.75 * pt
Private Const c_lngRecSel = 19 * pt
Private Const c_lngTagDelim = 0.75 * cm
Private Const Offset = 2
Private iMin As Byte, iMax As Byte, iStep As Byte
Private aData() As String, aMin As Long, aMax As Long
Private m_bytState As Byte
Private WithEvents frmData As Access.Form
Attribute frmData.VB_VarHelpID = -1
Private adoRst  As Object 'ADODB.Recordset  'WithEvents adoRst  As ADODB.Recordset
Const adInteger = 3, adVarChar = 200
Private Const c_strFieldIdx = "TextIdx", c_strFieldVal = "TextVal"

Private Function Samples()
' массив данных для примера
' Элемент массива: [i+0]=Type, [i+1]=String, [i+2]=Delim, [i+3]=TagDelim
    Samples = Array( _
        0, "Значение1;Значение2;Значение3", ";", "", _
        1, "Параметр1=Значение1;Параметр2=Значение2;Параметр3=Значение3", ";", "=", _
        2, "Таким хитроумным способом Винда демонстрирует юзеру, " & _
           "каким образом выглядят буквы в кириллических шрифтах для " & _
           "пользователей перевода Windows для России.", " .,?!:;-()", "", _
        2, "(X+3)*Y^2=Z", "=()[]{}<>+-*/\^", "", _
        0, p_RandomStr(1, ";"), ";", "", _
        1, p_RandomStr(2, ";", "="), ";", "=", _
        2, p_RandomStr(0, " .,?!:;-"), " .,?!:;-", "" _
        )
End Function

Private Sub Form_Open(Cancel As Integer):
Const cShadow = 0.075 * cm
    lblTitle.Caption = c_strTitle: lblTitle2.Caption = lblTitle.Caption: lblTitle2.Left = lblTitle.Left + cShadow: lblTitle2.Top = lblTitle.Top + cShadow
    lblComment.Caption = c_strComment
    lblLink.Caption = c_strLink: lblLink.HyperlinkAddress = c_strLink
    InsideHeight = Section(acDetail).Height + Section(acHeader).Height + Section(acFooter).Height
' начальные значения
    ctlData.SourceObject = "subDelimitedText"
    With ctlData.Form
        .OnCurrent = c_strCustomProc
        .AfterUpdate = c_strCustomProc
        '.BeforeInsert = c_strCustomProc
        .OnDelete = c_strCustomProc
    End With
    Set frmData = ctlData.Form
    iMin = LBound(Samples): iMax = UBound(Samples): iStep = 4
    txtIdx.Left = Indent
    txtVal.Left = txtIdx.Left + txtIdx.Width '+ Indent
    frmData.Width = txtVal.Left + txtVal.Width '-c_lngScroll-Indent
    m_bytState = p_SwitchSamples(iMin)
    Form_Resize
End Sub
Private Sub Form_Resize()
' обрабатываем изменение границ
    On Error Resume Next 'GoTo HandleError
Dim tmpWidth As Long:   tmpWidth = Me.InsideWidth '- ConvPixelsToTwips(rct.Right - rct.Left)
Dim i As Long
    For i = 1 To 9
        With Controls("Line" & Format$(i, "00"))
            If Err Then Err.Clear Else .Left = Indent: .Width = tmpWidth - 2 * Indent
        End With
    Next i
' ресайзим дополнительные контролы по форме
    With lblTitle:      .Width = tmpWidth - 4 * Indent: End With
    With lblTitle2:     .Width = tmpWidth - 4 * Indent: End With
    With lblComment:    .Width = tmpWidth - 4 * Indent: End With
    With lblLink:       .Width = tmpWidth - 4 * Indent: End With
    
    On Error GoTo HandleError
    With cmdNew: .Top = Indent: .Left = InsideWidth - .Width - Indent: End With
    With txtInput: .Width = cmdNew.Left - .Left - Indent: End With
    With txtDelim: .Width = IIf(txtType.Value = 1, txtInput.Left + txtInput.Width - c_lngTagDelim, cmdNew.Left) - .Left - Indent: End With
    With txtTagDelim: .Width = IIf(txtType.Value = 1, c_lngTagDelim, 0): .Left = txtDelim.Left + txtDelim.Width + Indent: .Visible = (txtType.Value = 1): End With
    With txtIdx: .Left = IIf(frmData.RecordSelectors, c_lngRecSel, Indent):   End With
    With txtIdx.Controls(0): .Left = .PARENT.Left: .Width = .PARENT.Width: End With
    With txtVal: .Left = txtIdx.Left + txtIdx.Width: .Width = InsideWidth - .Left - Indent: End With
    With txtVal.Controls(0): .Left = .PARENT.Left: .Width = .PARENT.Width: End With
    With ctlData: .Width = InsideWidth - .Left - Indent: .Height = (InsideHeight - Section(acHeader).Height - Section(acFooter).Height) - .Top - Indent: .Left = Indent: End With ': .Top = Indent: End With
    With frmData: .txtIdx.Left = 0: .txtIdx.Width = txtIdx.Width: .txtVal.Left = txtIdx.Width: .txtVal.Width = txtVal.Width - IIf((.ScrollBars And 2) = 2, c_lngScroll, 0): End With

HandleExit:  Exit Sub
HandleError: Err.Clear: Resume HandleExit
    Select Case Err.Number
    Case 2100 ' Элемент не может быть размещен в указанном месте
'        Section(acDetail).Height = Section(acDetail).Height + 2 * Indent
    Case Else: Stop
    End Select
    Err.Clear: Resume HandleExit
End Sub
Private Sub cmdNew_Click(): m_bytState = p_SwitchSamples(m_bytState + iStep): End Sub
Private Sub txtInput_AfterUpdate():     p_UpdateData: End Sub
Private Sub txtType_AfterUpdate():      p_UpdateData: End Sub
Private Sub txtDelim_AfterUpdate():     p_UpdateData: End Sub
Private Sub txtTagDelim_AfterUpdate():  p_UpdateData: End Sub
Private Sub txtIdx_AfterUpdate(): Call ItemSelect(txtIdx): p_GotoItem (txtIdx): End Sub
Private Sub txtVal_AfterUpdate(): Call ItemUpdate(txtIdx, txtVal): frmData.txtVal = txtVal: End Sub
Private Sub frmData_Current(): ItemSelect frmData.txtIdx: End Sub
'Private Sub frmData_BeforeInsert(Cancel As Integer): Cancel = Not ItemUpdate(frmData.txtIdx, frmData.txtVal): End Sub
Private Sub frmData_Delete(Cancel As Integer): Cancel = Not ItemDelete(frmData.txtIdx): End Sub
Private Sub frmData_AfterUpdate(): Call ItemUpdate(frmData.txtIdx, frmData.txtVal): End Sub

Private Function p_SwitchSamples(ByRef i As Byte) As Byte
    If i < iMin Or i > iMax Then i = iMin
    txtType.Value = Samples(i)
    txtInput.Value = Samples(i + 1)
    txtDelim.Value = Samples(i + 2)
    txtTagDelim.Value = Samples(i + 3)
    p_UpdateData
    p_SwitchSamples = i
End Function
Private Sub p_UpdateData() 'Optional ByVal Idx)
Dim strSource As String
Dim vIdx
Dim i As Long
' парсим txtInput по txtDelim и txtTagDelim
    ' создаем запрос подчинённой формы
    Set adoRst = CreateObject("ADODB.Recordset"): With adoRst: .Fields.Append c_strFieldIdx, adVarChar, 255: .Fields.Append c_strFieldVal, adVarChar, 255: .Open: End With
    Select Case txtType.Value
    Case 0 ' строка с разделителями
        aData() = Split(txtInput.Value, txtDelim.Value): aMin = LBound(aData): aMax = UBound(aData)
        For i = aMin To aMax
            vIdx = (i - aMin + 1)
            strSource = strSource & ";" & vIdx
            With adoRst: .AddNew: .Fields(c_strFieldIdx).Value = vIdx: .Fields(c_strFieldVal).Value = Trim$(aData(i)): .UpdateBatch: End With
        Next i
    Case 1 ' строка именованных значений
        If Len(Nz(txtTagDelim, vbNullString)) = 0 Then txtTagDelim = "="
        aData() = Split(txtInput.Value, txtDelim.Value): aMin = LBound(aData): aMax = UBound(aData)
Dim vVal, aTag() As String, tMin As Long, tMax As Long
        For i = aMin To aMax
            aTag() = Split(aData(i), txtTagDelim.Value): tMin = LBound(aTag): tMax = UBound(aTag)
            vIdx = aTag(tMin): If tMax > tMin Then vVal = aTag(tMin + 1) Else vVal = vbNullString
            strSource = strSource & ";" & "'" & vIdx & "'"
            With adoRst: .AddNew: .Fields(c_strFieldIdx).Value = vIdx: .Fields(c_strFieldVal).Value = vVal: .UpdateBatch: End With
        Next i
    Case 2 ' строка с множественными разделителями
        Call Tokenize(txtInput.Value, aData(), txtDelim.Value): aMin = LBound(aData): aMax = UBound(aData)
        For i = aMin To aMax
            vIdx = (i - aMin + 1)
            strSource = strSource & ";" & vIdx
            With adoRst: .AddNew: .Fields(c_strFieldIdx).Value = vIdx: .Fields(c_strFieldVal).Value = Trim$(aData(i)): .UpdateBatch: End With
        Next i
    Case Else
        strSource = vbNullString: aMin = 0: aMax = 0
    End Select
    If Left$(strSource, 1) = ";" Then strSource = Mid$(strSource, 2)
' заполняем данные подчинённой формы (сбивает Idx)
    Set frmData.Recordset = adoRst
' заполняем поле списка индексов (порядковый номер или имя параметра строки)
    With txtIdx: .RowSourceType = "Value List": .RowSource = strSource: .Visible = True: End With
' отображаем прячем поля
    With txtDelim: .Width = IIf(txtType.Value = 1, txtInput.Left + txtInput.Width - c_lngTagDelim, cmdNew.Left) - .Left - Indent: End With
    With txtTagDelim: .Width = IIf(txtType.Value = 1, c_lngTagDelim, 0): .Left = txtDelim.Left + txtDelim.Width + Indent: .Visible = (txtType.Value = 1): End With
' выбираем значение
    adoRst.MoveFirst ' Else Call ItemSelect(Idx)
End Sub
Public Function ItemSelect(idx) As Boolean
Dim strValue As String
Dim sBeg As Long, sEnd As Long
Dim Result As Boolean
    Result = False
    On Error GoTo HandleError
' получаем значение
    Select Case txtType.Value
    Case 0: strValue = DelimStringGet(txtInput.Value, CLng(idx), txtDelim.Value, sBeg:=sBeg, sEnd:=sEnd)
    Case 1: strValue = TaggedStringGet(txtInput.Value, CStr(idx), txtDelim.Value, txtTagDelim.Value, sBeg:=sBeg, sEnd:=sEnd)
    Case 2: strValue = TokenStringGet(txtInput.Value, CLng(idx), txtDelim.Value, sBeg:=sBeg, sEnd:=sEnd)
    End Select
' выделяем фрагмент в исходной строке
    With txtInput: .SetFocus: .SelStart = sBeg - 1: .SelLength = sEnd - sBeg: End With
    Result = True
HandleExit:  txtIdx.Value = idx: txtVal.Value = strValue: ItemSelect = Result: Exit Function
HandleError: Result = False: strValue = vbNullString: Err.Clear: Resume HandleExit
End Function
Public Function ItemUpdate(idx, NewValue As String) As Boolean
Dim strValue As String
Dim sBeg As Long, sEnd As Long
Dim Result As Boolean
    Result = False
    On Error GoTo HandleError
' получаем значение
    Select Case txtType.Value
    Case 0: strValue = DelimStringSet(txtInput.Value, CLng(idx), NewValue, txtDelim.Value, Overwrite:=True, sBeg:=sBeg, sEnd:=sEnd)
    Case 1: strValue = TaggedStringSet(txtInput.Value, CStr(idx), NewValue, txtDelim.Value, txtTagDelim.Value, sBeg:=sBeg, sEnd:=sEnd)
    Case 2: strValue = TokenStringSet(txtInput.Value, CLng(idx), NewValue, txtDelim.Value, Overwrite:=True, sBeg:=sBeg, sEnd:=sEnd)
    End Select
' выделяем фрагмент в исходной строке
    'txtVal = NewValue: frmData.txtVal = NewValue
    txtInput.Value = strValue: Result = True
HandleExit:  ItemUpdate = Result: Exit Function
HandleError: Result = False: strValue = vbNullString: Err.Clear: Resume HandleExit
End Function
Public Function ItemDelete(iNum As Integer) As Boolean

End Function
Private Function p_RandomStr(Optional intType = 0, Optional Delim As String, Optional TagDelim As String) As String
Dim i As Long, iMax As Integer
Dim j As Long, jMax As Integer
Dim sLen As Integer, dLen As Integer
Const cstrName = "Параметр"
Dim nLen As Integer
Dim strName As String, strValue As String, strDelim As String
Dim Result As String
    iMax = CLng(100 * Rnd()) + 6 ' количество элементов
    sLen = CLng(12 * Rnd()) + 3  ' длина элементов (±dLen)
    dLen = 3                     ' макс колебания длины элемента отн-но sLen
    jMax = 3                     ' максимальное количество разделителей подряд (для intType=0)
    sLen = sLen - dLen: If sLen < 1 Then sLen = 1: dLen = 1 / 2 * dLen
    
    strDelim = Delim
    Result = vbNullString
    For i = 1 To iMax
        Select Case intType
        Case 0 ' строка с множественными разделителями
        strDelim = GenPassword(CInt((jMax) * Rnd()) + 1, Delim, bRepeats:=False, NewSeed:=False)
        Case 1 ' строка с разделителями
        Case 2 ' строка именованных значений
        strName = cstrName & Format$(i, String(3, "0"))
        Result = Result & strName & TagDelim
        End Select
        strValue = GenPassword(CInt(2 * dLen * Rnd()) + sLen, "abcdefghijklmnopqrstuvwxyz", NewSeed:=False)
        Result = Result & strValue & strDelim
    Next i
    p_RandomStr = Left$(Result, Len(Result) - Len(strDelim))
End Function
Private Function p_GotoItem(idx As String)
' выделяем фрагмент в списке
Dim rst: Set rst = adoRst.Clone
Dim Result As Boolean
    Result = False
    On Error GoTo HandleError
    rst.MoveFirst
    rst.Find "[" & c_strFieldIdx & "]='" & idx & "'" ', 1, 1
    adoRst.Bookmark = rst.Bookmark
    Result = True
HandleExit:  p_GotoItem = Result: Exit Function
HandleError: Result = False: Err.Clear: Resume HandleExit
End Function